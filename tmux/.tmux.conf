##########################################
# Terminfo
##########################################
set -g default-terminal "${TERM}"
# set -g default-terminal "tmux-256color"
#set-option -g default-shell /bin/zsh

# https://evantravers.com/articles/2021/02/05/curly-underlines-in-kitty-tmux-neovim/
# undercurl support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
# underscore colours - needs tmux-3.0
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# true color support
set -ga terminal-overrides ",*:Tc"

##########################################
# Options
##########################################

# avoid conflicts between <ESC> and <ALT>+...
set -g escape-time 10
set -g history-limit 100000
# message display time
set -g display-time 3000

# 1-based index
set  -g base-index 1
setw -g pane-base-index 1

# focus-events
set -g focus-events on

# Mouse support
set -g mouse on
#set -g mouse-resize-pane on
#set -g mouse-select-pane on
#set -g mouse-select-window on

##########################################
# Key Bindings
##########################################
# Prefix
#set -g prefix C-Space
bind C-b send-prefix

# Source configuration
bind R source-file ~/.tmux.conf \; display "Configuration reloaded!"

# New window
bind c new-window -c "#{pane_current_path}"
# Last window
bind -r \; last-window
# Kill window
bind X kill-window
bind -N "Next window" -r Tab next-window

# -/_: Split panes horizontally/vertically
unbind-key '"'
unbind-key %
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -h -c "#{pane_current_path}"
# h/j/k/l: move in panes
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R
# C-hjkl: Resize panes
bind -r C-h resize-pane -L 5
bind -r C-j resize-pane -D 5
bind -r C-k resize-pane -U 5
bind -r C-l resize-pane -R 5
# HJKL: Resize panes subtly
bind -r H resize-pane -L
bind -r J resize-pane -D
bind -r K resize-pane -U
bind -r L resize-pane -R

# copy/paste
setw -g mode-keys vi
unbind [
bind -N "Enter copy mode" v copy-mode
unbind ]
bind -N "Paste buffer" p paste-buffer
unbind =
bind -N "Choose a paste buffer" P choose-buffer
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection

##########################################
# Theme
##########################################

# colorscheme: Catppuccin-mocha
thm_bg0="#1e1e2e" # base
thm_bg1="#45475a" # surface1
thm_bg2="#6c7086" # overlay0
thm_fg0="#cdd6f4" # text
thm_main="#89b4fa" # blue
thm_important="#f38ba8" # red

# Status
#set -g status-position top
set -g status-justify centre
set -g status "on"
set -g status-bg "${thm_bg0}"
set -g status-justify "left"
set -g status-left-length "400"
set -g status-right-length "400"

# Messages
set -g message-style fg="${thm_main}",bg="${thm_bg1}",align="centre"
set -g message-command-style fg="${thm_important}",bg="${thm_bg1}",align="centre"

# Panes
set -g pane-border-style fg="${thm_bg2}"
set -g pane-active-border-style fg="${thm_main}"

# Windows
setw -g window-status-activity-style fg="${thm_fg0}",bg="${thm_bg0}",none
setw -g window-status-separator ""
setw -g window-status-style fg="${thm_fg0}",bg="${thm_bg1}",none
setw -g window-status-format " #I #W "
setw -g window-status-current-format " #I #W "
setw -g window-status-separator ""
#setw -g window-status-current-style "bg=$thm_main, fg=$thm_bg0"
setw -g window-status-current-style "bg=$thm_main, fg=$thm_bg0"
setw -g window-status-last-style "fg=$thm_main"

# Statusline
set -g status-style "bg=$thm_bg0, fg=$thm_fg0"
set -g status-left "#[bg=$thm_bg2, fg=$thm_fg0] îž• #S "
set -g status-right "#[bg=$thm_important, fg=$thm_bg0]#{?client_prefix, ^B ,#{?pane_in_mode,#{?selection_present, V , MODE },}}#[bg=$thm_bg1, fg=$thm_fg0] #h #[bg=$thm_bg2, fg=$thm_fg0] %Y-%m-%d %H:%M "

# Modes
setw -g clock-mode-colour "${thm_main}"
setw -g mode-style "fg=${thm_bg0},bg=${thm_main}"

##########################################
# Plugins
##########################################
#set -g @plugin 'tmux-plugins/tpm'

#set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
#set -g @prefix_highlight_fg $base5
#set -g @prefix_highlight_bg $extra0
#set -g @prefix_highlight_prefix_prompt 'Wait'
#set -g @prefix_highlight_show_copy_mode 'on'
#set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold'
#set -g @prefix_highlight_show_sync_mode 'on'
#set -g @prefix_highlight_sync_mode_attr 'fg=black,bg=green'

#set -g @plugin 'tmux-plugins/tmux-battery'
#
#set -g status-right "#{prefix_highlight}\
##[fg=$base5]\
##{battery_color_bg} #{battery_percentage} #{battery_icon} \
##[bg=$base1, fg=$base3] #h #[bg=$base0, fg=$base3] %Y-%m-%d %H:%M "

#run '~/.tmux/plugins/tpm/tpm'
